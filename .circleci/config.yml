version: 2.1
orbs:
  pulumi: pulumi/pulumi@2.0.0
  ghpr: narrativescience/ghpr@1.1.1
  browser-tools: circleci/browser-tools@1.1.3

jobs:
  build:
    docker:
      - image: 'circleci/node:14.16-browsers'
    working_directory: ~/repo/
    steps:
      - checkout
      # - setup_remote_docker:
      #     version: 19.03.13
      # - pulumi/login
      # - pulumi/stack_init:
      #     stack: 'proxor-theia/test-pr_${CIRCLE_BUILD_NUM}'
      # - run:
      #       name: Install dependency and set pulumi region
      #       command: |
      #         npm install
      #         pulumi config set aws:region ap-south-1
      # - pulumi/update:
      #     stack: 'proxor-theia/test-pr_${CIRCLE_BUILD_NUM}'
      # - pulumi/stack_output:
      #     stack: 'proxor-theia/test-pr_${CIRCLE_BUILD_NUM}'
      #     property_name: demoUrl
      #     env_var: TEST_URL
      # - ghpr/post-pr-comment:
      #     comment: ${TEST_URL}
      #     when: always
      - browser-tools/install-chrome
      - browser-tools/install-chromedriver
      - run: cd selenium-tests && npm install
      # run tests
      - run: cd selenium-tests && npm run theiaCommon -- --baseUrl http://15.207.254.212:4000